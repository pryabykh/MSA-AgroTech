### <a name="_b7urdng99y53"></a>**Название задачи: Разработка вариантов решений**
### <a name="_hjk0fkfyohdk"></a>**Автор: Pavel R.**
### <a name="_uanumrh8zrui"></a>**Дата: 01.03.2026**

## 1. Контекст

Система управления фермой требует:
- Обработки потока событий от компьютерного зрения (CV)
- Оповещения дежурных сотрудников о критических событиях
- Масштабируемости при росте поголовья и устройств
- Надёжной доставки событий между микросервисами

Рассматриваются два архитектурных решения, различающиеся выбором брокера сообщений и каналами уведомлений.

---

## 2. Критерии сравнения

| Критерий | Описание | Вес |
|----------|----------|-----|
| **Компетенции команды** | Наличие опыта эксплуатации технологии в продакшене | Высокий |
| **Масштабируемость** | Способность обрабатывать рост нагрузки (события CV) | Высокий |
| **Сложность MVP** | Объём работ для первого релиза | Средний |
| **Отказоустойчивость** | Устойчивость к потере событий и сбоям | Высокий |
| **Операционные расходы** | Стоимость инфраструктуры и поддержки | Средний |
| **Возможность аудита** | Хранение истории событий для расследования инцидентов | Средний |
| **Время внедрения** | Срок до запуска первого релиза | Высокий |

---

## 3. Анализ вариантов

### Вариант 1: Kafka + SMS (Основной)

| Критерий | Оценка | Обоснование |
|----------|--------|-------------|
| Компетенции команды | ✅ 5/5 | Есть успешный опыт эксплуатации Kafka в продакшене |
| Масштабируемость | ✅ 5/5 | Kafka оптимизирована для high-throughput event streaming |
| Сложность MVP | ✅ 5/5 | Только SMS-уведомления, минимальный scope |
| Отказоустойчивость | ✅ 5/5 | Репликация топиков, сохранение событий в логе |
| Операционные расходы | ⚠️ 3/5 | Kafka требует больше ресурсов, чем RabbitMQ |
| Возможность аудита | ✅ 5/5 | Log-based хранение, возможность реплея событий |
| Время внедрения | ✅ 5/5 | 4-6 недель до релиза |

**Итого:** 33/35

---

### Вариант 2: RabbitMQ + SMS + Звонки (Альтернативный)

| Критерий | Оценка | Обоснование |
|----------|--------|-------------|
| Компетенции команды | ⚠️ 3/5 | Требуется изучение новых паттернов и настройка |
| Масштабируемость | ⚠️ 3/5 | RabbitMQ требует тонкой настройки QoS при пиковых нагрузках |
| Сложность MVP | ⚠️ 3/5 | Интеграция системы звонков увеличивает scope |
| Отказоустойчивость | ⚠️ 3/5 | Сообщения удаляются после потребления, нет реплея |
| Операционные расходы | ✅ 4/5 | RabbitMQ легче по ресурсам, но звонки дороже SMS |
| Возможность аудита | ⚠️ 2/5 | Нет встроенного хранения истории событий |
| Время внедрения | ⚠️ 3/5 | 8-10 недель до релиза (интеграция call-системы) |

**Итого:** 21/35

---

## 4. Сравнительная таблица

| Характеристика | Kafka + SMS | RabbitMQ + Звонки |
|----------------|-------------|-------------------|
| Брокер сообщений | Apache Kafka | RabbitMQ |
| Каналы уведомлений | SMS | SMS + Voice Calls |
| Хранение событий | 7+ дней (настраиваемо) | До подтверждения потребления |
| Пропускная способность | 100K+ сообщений/сек | 10K-50K сообщений/сек |
| Реплей событий | ✅ Поддерживается | ❌ Не поддерживается |
| Опыт команды | ✅ Есть | ❌ Требуется изучение |
| Срок MVP | 4-6 недель | 8-10 недель |
| Интеграции | 1 (SMS) | 2 (SMS + Call) |

---

## 5. Решение

**Выбран Вариант 1: Kafka + SMS**

### Обоснование:

1. **Снижение рисков:** Команда имеет опыт эксплуатации Kafka, что минимизирует риски при запуске и упрощает поддержку.
2. **Фокус на MVP:** Голосовые уведомления выходят за рамки критического функционала. SMS полностью покрывают сценарии аварийных оповещений.
3. **Архитектурная готовность к росту:** Kafka обеспечивает лучшую масштабируемость для потоковых данных от компьютерного зрения и позволяет хранить историю событий для аудита.
4. **Возможность итеративного развития:** Функцию звонков можно добавить на основе обратной связи от пользователей после запуска MVP.

---

## 6. Последствия

### Положительные:
- ✅ Быстрый запуск MVP (4-6 недель)
- ✅ Снижение операционных рисков (знакомый стек)
- ✅ Возможность ретроспективного анализа событий
- ✅ Лучшая устойчивость к пиковым нагрузкам

### Отрицательные:
- ⚠️ Kafka требует больше ресурсов инфраструктуры, чем RabbitMQ
- ⚠️ Отсутствие голосовых уведомлений в первом релизе (может быть воспринято как ограничение)

### Нейтральные:
- → Голосовые уведомления могут быть добавлены в будущих итерациях без изменения архитектуры

---

## 7. Метрики успеха

| Метрика | Целевое значение |
|---------|------------------|
| Время доставки события (CV → SMS) | < 5 секунд |
| Доступность системы | 99.5% |
| Потеря событий | 0% |
| Время развёртывания MVP | ≤ 6 недель |

---
