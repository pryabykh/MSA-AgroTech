### <a name="_b7urdng99y53"></a>**Название задачи: Разработка вариантов решений**
### <a name="_hjk0fkfyohdk"></a>**Автор: Pavel R.**
### <a name="_uanumrh8zrui"></a>**Дата: 28.02.2026**
### <a name="_3bfxc9a45514"></a>**Функциональные требования**

| **№** | **Действующие лица или системы**                        | **Use Case**                                                           | **Описание**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |
|:-----:|:--------------------------------------------------------|:-----------------------------------------------------------------------|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  UC1  | Административный персонал                               | Настройка кормушек и поилок                                            | 1. Администратор заходит в веб-портал в раздел настроек работы кормушек и поилок.<br/>2. В списке доступных кормушек и поилок администратор выбирает интересующие кормушки и поилки.<br/>3. Администратор задает настройки кормушкам и поилкам от разных производителей через единый интерфейс.<br/>4. Соответствующие настройки применяются к оборудованию на местах.                                                                                                                                                  |
|  UC2  | Административный персонал                               | Отслеживание запасов еды и прогнозирование расхода                     | 1. Администратор заходит в веб-портал в раздел контроля запасов еды.<br/>2. Администратор смотрит остаток еды на текущий момент.<br/>3. Администратор смотрит выбирает период в интерфейсе и видит скорость расхода еды за выбранный промежуток времени.                                                                                                                                                                                                                                                                |
|  UC3  | Дежурные сотрудники, система                            | Уведомление дежурного сотрудника о ситуациях, требующих вмешательства  | 1. Система обнаруживает внештатную ситуацию (например,  признаки беспокойного поведения или драк среди животных, признаки задавливания поросят, болезнь или гибель скота).<br/>2. По факту обнаружения внештатной ситуации система фиксирует конкретный факт в логе внештатных событий.<br/>3. Вместе с фиксацией система отправляет уведомление дежурному сотруднику о наличии внештатной ситуации.<br/>4. Дежурный сотрудник подтверждает получение уведомления.<br/>5. Система помечает уведомление, как полученное. |
|  UC4  | Дежурные сотрудники, система                            | Уведомление дежурного сотрудника по СМС при отсутствии быстрой реакции | 1. Система обнаруживает внештатную ситуацию (например,  признаки беспокойного поведения или драк среди животных, признаки задавливания поросят, болезнь или гибель скота).<br/>2. Система отправляет уведомление дежурному сотруднику о наличии внештатной ситуации.<br/>3. Дежурный сотрудник не подтверждает получение в течение установленного времени (например, из-за неработающего интернета на оборудовании сотрудника).<br/>4. Система отравляет СМС сообщение на номер дежурного сотрудника.                   |
|  UC5  | Административный персонал, дежурные сотрудники          | Отслеживание состояния систем фильтрации воды                          | 1. Администратор или дежурный сотрудник заходит на веб-портал в раздел контроля состояния систем фильтрации воды.<br/>2. Соответствующий пользователь видит метрики состояни систем фильтрации воды.                                                                                                                                                                                                                                                                                                                    |
|  UC6  | Административный персонал, дежурные сотрудники          | Пересчет поголовья                                                     | 1. Администратор или дежурный сотрудник заходит на веб-портал в раздел контроля количества поголовья скота.<br/>2. Соответствующий пользователь видит метрики количества поголовья скота на текущий момент времени.                                                                                                                                                                                                                                                                                                     |
|  UC7  | Административный персонал, дежурные сотрудники, система | Аутентификация и авторизация                                           | 1. Пользователь входит в систему.<br/>2. Система просит его ввести логин и пароль.<br/>3.Пользователь вводит логин и пароль.<br/>4. Система определяет роль пользователя и позволяет действовать ему в рамках полномочий, выданных для его роли.                                                                                                                                                                                                                                                                        |
|  UC8  | Система                                                 | Предоставление интерфейса для получения метрик                         | 1. Система собирает метрики о своей работе.<br/>2. Внешние системы могут обращаться за этими метриками для последующей обработки и агрегации.                                                                                                                                                                                                                                                                                                                                                                           |

### <a name="_u8xz25hbrgql"></a>**Нефункциональные требования**

| **№** | **Требование**                                                                                                                                                                      |
|:-----:|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
|  1.   | Обеспечивать достаточно высокую отказоустойчивость 99,95%.                                                                                                                          |
|  2.   | Быть расширяемой, то есть иметь возможность разработать новый функционал без изменений существующего.                                                                               |
|  3.   | Иметь высокую производительность — от момента возникновения нештатной ситуации, зафиксированной с помощью видеоаналитики, должно проходить не более 5 секунд до момента оповещения. |
|  4.   | Позволять системе видеоаналитики реагировать в реальном времени (миллисекунды).                                                                                                     |

### <a name="_qmphm5d6rvi3"></a>**Решение**
Диаграмма контейнеров (в нотации C4) архитектурного решения: [C2_Main.puml](C2_Main.puml)

Было принято решение использовать следующие технологии:

Микросервисная архитектура (Spring Boot): Разделение на доменные сервисы (кормление, поение, инвентарь, события) позволяет независимо масштабировать, тестировать и обновлять функционал без риска для всей системы.

Паттерн «Адаптер» для оборудования: Выделение отдельных сервисов для работы с кормушками и поилками изолирует логику взаимодействия с разнородным «железом» разных производителей. Это упрощает поддержку и подключение новых устройств.

Событийная архитектура (Kafka): Асинхронная передача данных от компьютерного зрения через брокер сообщений развязывает тяжелые процессы анализа видео и бизнес-логику, повышая отказоустойчивость и производительность.

Полиглотное программирование: Используется оптимальный стек под задачу: Java для надежной бизнес-логики, Python для ML/Computer Vision, C++ для embedded-устройств, React для UI.

Централизованная безопасность (Keycloak): Вынос IAM во внешний сервис стандартизирует аутентификацию и авторизацию, освобождая микросервисы от дублирования логики безопасности.

API Gateway: Единая точка входа для веб-интерфейса упрощает клиентскую часть, скрывает внутреннюю структуру бэкенда и централизует маршрутизацию запросов.

В совокупности эти решения обеспечивают гибкость, масштабируемость и надежность системы для управления фермой.

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Диаграмма контейнеров (в нотации C4) альтернативного архитектурного решения: [C2_Alternative.puml](C2_Alternative.puml)

Альтернативное решение предполагает использование RabbitMQ в качестве брокера сообщений. 

Также альтернативное решение включает поддержку GSM звонков в качестве способа оповещения дежурного сотрудника.

**Недостатки, ограничения, риски**

Компетенции команды: У команды уже есть успешный опыт эксплуатации Kafka в продакшене. Это снижает риски при запуске, ускоряет разработку и упрощает поддержку, тогда как внедрение RabbitMQ потребовало бы времени на изучение новых паттернов и настройку.

MVP-фокус (звонки отложены): Функция голосовых уведомлений выходит за рамки текущего MVP. SMS-оповещения полностью покрывают критические сценарии (аварии, тревожные события), а звонки можно добавить итеративно на основе обратной связи от пользователей, не усложняя первый релиз.
